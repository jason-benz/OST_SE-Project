@page "/mediaSearch"

<PageTitle>Search Media</PageTitle>
@using MediaHub.Data.Model
@using MediaHub.Data.ViewModel
@using MediaHub.View
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@inject ProtectedSessionStorage SessionStorage
@inject IMediaSearchViewModel MediaServiceInstance

<h1 class="center-heading">Search for Media</h1>

<form class="media-search" @onsubmit=SearchCall>
    <input class="form-control" type="search" placeholder="Search for Media ..." @bind="searchString"/>
    <button type="submit" class="btn btn-primary">Search</button>
</form>

<div class="search-result-box">
    <MediaTable MediaList="@mediaList" AlternativeText="Sorry, but there is no media found according to your search text."/>
</div>

@code
{
    private List<IMovie>? mediaList;

    protected override async Task OnInitializedAsync()
    {
        var result = await SessionStorage.GetAsync<string>("SearchString");
        if (result.Success)
        {
            if(result.Value != null)
            {
                searchString = result.Value;
                await SearchCall();
            }
        }
    }

    protected async Task SearchCall()
    {
        await SessionStorage.SetAsync("SearchString", searchString);
        mediaList = await MediaServiceInstance.GetMoviesAsync(searchString);
    }

    private string searchString { get; set; } = "";

}